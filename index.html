<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Drift: Ultimate Control</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; touch-action: none; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.7); z-index: 1000; }
        .auth-card { background: white; padding: 30px; border-radius: 15px; text-align: center; color: black; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input { background: #f0f0f0; border: 1px solid #ccc; color: #000; padding: 12px; margin: 5px 0; width: 220px; border-radius: 8px; font-weight: bold; }
        button { background: #222; border: none; color: #fff; padding: 12px 24px; font-size: 14px; font-weight: bold; cursor: pointer; transition: 0.3s; margin: 5px; border-radius: 8px; }
        button:hover { background: #444; transform: scale(1.05); }
        .stats { position: absolute; top: 15px; left: 15px; z-index: 500; font-size: 16px; color: #fff; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; border-left: 5px solid #ffcc00; }
        
        /* Modals */
        #shop-modal, #leaderboard-gui, #admin-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; color: black; padding: 25px; z-index: 2000; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; border-radius: 20px; box-shadow: 0 0 100px rgba(0,0,0,0.8); }
        .admin-section { border-top: 2px solid #eee; margin-top: 15px; padding-top: 15px; text-align: center; }
        .admin-section h3 { margin: 0 0 10px 0; color: #cc0000; font-size: 14px; }
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .shop-item { border: 1px solid #eee; padding: 10px; border-radius: 10px; text-align: center; background: #fafafa; }

        /* MOBIL TUSLAR */
        .mobile-controls {
            position: absolute; bottom: 30px; left: 0; width: 100%;
            display: flex; justify-content: space-around; pointer-events: none; z-index: 1500;
        }
        .joy-btn {
            width: 80px; height: 80px; background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 30px; color: white; user-select: none; pointer-events: auto;
            backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
        }
        .joy-btn:active { background: rgba(255,255,255,0.5); transform: scale(0.9); }
    </style>
</head>
<body>

    <div id="auth-screen" class="overlay">
        <div class="auth-card">
            <h1 style="margin-top:0">NEON DRIFT</h1>
            <input type="text" id="username" placeholder="Kullanƒ±cƒ± Adƒ±"><br>
            <input type="password" id="password" placeholder="≈ûifre"><br>
            <button onclick="window.handleAuth('login')">Gƒ∞Rƒ∞≈û YAP</button>
            <button onclick="window.handleAuth('register')" style="background:#eee; color:#333">KAYIT OL</button>
        </div>
    </div>

    <div id="main-menu" class="overlay" style="display:none">
        <h1 id="welcome-text">HO≈û GELDƒ∞N</h1>
        <div style="margin-bottom:20px">
            <button onclick="window.startGame('EASY')" style="background:#4CAF50">KOLAY</button>
            <button onclick="window.startGame('MEDIUM')" style="background:#FF9800">ORTA</button>
            <button onclick="window.startGame('HARD')" style="background:#f44336">ZOR</button>
        </div>
        <button onclick="window.toggleShop()" style="background:#ffcc00; color:#000;">üõí MARKET</button>
        <button onclick="window.toggleLB()" style="background:#2196F3;">üèÜ SIRALAMA</button>
        
        <div style="margin-top:30px; background:rgba(255,255,255,0.1); padding:10px; border-radius:10px">
            <input type="text" id="admin-input" placeholder="Sƒ∞STEM KODU" style="width:120px; padding:5px;">
            <button onclick="window.activateCode()" style="padding:6px;">YETKƒ∞ VER</button>
        </div>
        <button id="adm-btn" onclick="window.toggleAdmin()" style="display:none; background:red; margin-top:10px">‚ö° GOD PANEL</button>
    </div>

    <div id="shop-modal">
        <h2>MARKET</h2>
        <div id="market-items" class="shop-grid"></div>
        <button onclick="window.toggleShop()" style="width:100%; margin-top:15px; background:#666">KAPAT</button>
    </div>

    <div id="admin-modal">
        <h2 style="color:red; text-align:center">MODERAT√ñR PANELƒ∞</h2>
        
        <div class="admin-section">
            <h3>PARA Y√ñNETƒ∞Mƒ∞</h3>
            <input type="number" id="adm-amount" placeholder="Miktar Yaz..." style="width:80%"><br>
            <button onclick="window.modifyMoney(1)" style="background:green">+ EKLE</button>
            <button onclick="window.modifyMoney(-1)" style="background:orange">- Sƒ∞L</button>
        </div>

        <div class="admin-section">
            <h3>SKOR Y√ñNETƒ∞Mƒ∞</h3>
            <input type="number" id="adm-score-input" placeholder="Miktar Yaz..." style="width:80%"><br>
            <button onclick="window.modifyScore(1)" style="background:blue">+ ARTIR</button>
            <button onclick="window.modifyScore(-1)" style="background:purple">- EKSƒ∞LT</button>
        </div>

        <div class="admin-section">
            <h3>Sƒ∞STEM</h3>
            <button id="imm-btn" onclick="window.admImmortal()" style="width:100%">√ñL√úMS√úZL√úK: KAPALI</button>
            <button onclick="window.admNuke()" style="width:100%; background:black">EKRANI TEMƒ∞ZLE</button>
            <button onclick="window.resetAllData()" style="width:100%; background:#cc0000; font-size:10px">T√úM VERƒ∞LERƒ∞ SIFIRLA</button>
        </div>
        
        <button onclick="window.toggleAdmin()" style="width:100%; margin-top:20px; background:#333">PANELƒ∞ KAPAT</button>
    </div>

    <div id="leaderboard-gui">
        <h2>Lƒ∞DERLƒ∞K TABLOSU</h2>
        <div style="display:flex; gap:10px; margin-bottom:15px">
            <button onclick="window.switchLB('highscore')" id="lb-s" style="flex:1">EN Y√úKSEK SKOR</button>
            <button onclick="window.switchLB('bank')" id="lb-b" style="flex:1">EN ZENGƒ∞NLER</button>
        </div>
        <div id="lb-content" style="color:#333"></div>
        <button onclick="window.toggleLB()" style="width:100%; margin-top:15px; background:#666">KAPAT</button>
    </div>

    <div id="game-ui" style="display:none">
        <div class="stats">
            <b>OYUNCU:</b> <span id="ui-user">?</span><br>
            <b>SKOR:</b> <span id="score-val">0</span><br>
            <b>ENERJƒ∞:</b> <span id="bank-val">0</span>
        </div>
        <div class="mobile-controls">
            <div class="joy-btn" id="btn-left">‚óÄ</div>
            <div class="joy-btn" id="btn-right">‚ñ∂</div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

        let users = JSON.parse(localStorage.getItem('neon_users')) || {};
        let currentUser = localStorage.getItem('neon_last_user') || null;
        let isImmortal = false;

        const products = Array.from({length: 20}, (_, i) => ({
            id: 'p'+i, n: ['Mƒ±knatƒ±s', 'Kalkan', 'Nitro', 'Turbo', 'X2 Puan', 'Yava≈ülatƒ±cƒ±', 'Nuke', 'Canlanma', 'Matrix', 'Zƒ±rh', 'Motor', 'Fren', 'Radar', 'Gizlilik', 'Sƒ±√ßrama', 'Altƒ±n', 'Elmas', 'Platin', 'Hƒ±z', 'U√ßu≈ü'][i], p: (i+1)*1000
        }));

        // --- AUTH ---
        window.handleAuth = (mode) => {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value;
            if(!u || !p) return alert("Alanlarƒ± doldur!");
            if(mode === 'register') {
                if(users[u]) return alert("Bu isim alƒ±nmƒ±≈ü!");
                users[u] = { password: p, bank: 0, highscore: 0, upgrades: {} };
                alert("Kayƒ±t ba≈üarƒ±lƒ±! Giri≈ü yapabilirsin.");
            } else {
                if(users[u] && users[u].password === p) {
                    currentUser = u; localStorage.setItem('neon_last_user', u);
                    location.reload();
                } else alert("Hatalƒ± bilgi!");
            }
            save();
        };

        // --- ADMIN CONTROLS ---
        window.modifyMoney = (dir) => {
            const val = parseInt(document.getElementById('adm-amount').value) || 0;
            users[currentUser].bank += (val * dir);
            if(users[currentUser].bank < 0) users[currentUser].bank = 0;
            save(); updateUI(); alert("Para g√ºncellendi!");
        };

        window.modifyScore = (dir) => {
            const val = parseInt(document.getElementById('adm-score-input').value) || 0;
            score += (val * dir);
            if(score < 0) score = 0;
            updateUI();
        };

        window.resetAllData = () => { if(confirm("T√úM HESAPLAR Sƒ∞Lƒ∞NECEK! Emin misin?")) { localStorage.clear(); location.reload(); } };

        window.activateCode = () => { if(document.getElementById('admin-input').value === "RereM_Gemes") { document.getElementById('adm-btn').style.display = 'block'; alert("Y√ñNETƒ∞Cƒ∞ YETKƒ∞Sƒ∞ ALINDI!"); } };
        window.toggleAdmin = () => { const m = document.getElementById('admin-modal'); m.style.display = m.style.display === 'block' ? 'none' : 'block'; };
        window.admImmortal = () => { isImmortal = !isImmortal; document.getElementById('imm-btn').innerText = "√ñL√úMS√úZL√úK: " + (isImmortal ? "A√áIK" : "KAPALI"); document.getElementById('imm-btn').style.background = isImmortal ? "green" : "#222"; };
        window.admNuke = () => { obstacles.forEach(o => scene.remove(o)); obstacles = []; };

        window.toggleShop = () => {
            const m = document.getElementById('shop-modal'); m.style.display = m.style.display === 'block' ? 'none' : 'block';
            if(m.style.display === 'block') {
                document.getElementById('market-items').innerHTML = products.map(x => `<div class="shop-item"><b>${x.n}</b><br><button onclick="window.buy('${x.id}', ${x.p})">${users[currentUser].upgrades[x.id] ? 'SAHƒ∞PSƒ∞N' : x.p+' E'}</button></div>`).join('');
            }
        };

        window.buy = (id, p) => { if(users[currentUser].bank >= p && !users[currentUser].upgrades[id]) { users[currentUser].bank -= p; users[currentUser].upgrades[id] = true; save(); window.toggleShop(); window.toggleShop(); } };

        window.toggleLB = () => { const m = document.getElementById('leaderboard-gui'); m.style.display = m.style.display === 'block' ? 'none' : 'block'; if(m.style.display === 'block') window.switchLB('highscore'); };
        window.switchLB = (t) => { const s = Object.entries(users).map(([n, d]) => ({n, v: d[t]})).sort((a,b) => b.v - a.v).slice(0, 10); document.getElementById('lb-content').innerHTML = s.map((u, i) => `<div style="padding:8px; border-bottom:1px solid #eee">#${i+1} <b>${u.n}</b> <span style="float:right">${u.v.toLocaleString()}</span></div>`).join(''); };

        function save() { localStorage.setItem('neon_users', JSON.stringify(users)); }

        // --- GAME ENGINE ---
        let scene, camera, renderer, player, road;
        let obstacles = [], crystals = [], decor = [], score = 0, speed = 0;
        let playerVelX = 0; const keys = { a: false, d: false };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 30, 160);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 7, 13);
            camera.lookAt(0, 0, -10);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // GROUND
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(2000, 2000), new THREE.MeshStandardMaterial({ color: 0x2d5a27 }));
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);

            // ROAD
            road = new THREE.Mesh(new THREE.PlaneGeometry(22, 2000), new THREE.MeshStandardMaterial({ color: 0x222222 }));
            road.rotation.x = -Math.PI / 2;
            road.position.y = 0.05;
            scene.add(road);

            // DAƒûLAR
            for(let i=0; i<30; i++) {
                const h = Math.random() * 25 + 15;
                const m = new THREE.Mesh(new THREE.ConeGeometry(10, h, 4), new THREE.MeshStandardMaterial({ color: 0x444444 }));
                m.position.set(i % 2 === 0 ? 50 : -50, h/2, -i * 60);
                scene.add(m); decor.push(m);
            }

            player = new THREE.Mesh(new THREE.IcosahedronGeometry(0.8, 2), new THREE.MeshStandardMaterial({ color: 0x00ffff, wireframe: true }));
            player.position.y = 1.2;
            scene.add(player);

            scene.add(new THREE.DirectionalLight(0xffffff, 1.2));
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));

            // KONTROLLER (KLAVYE + MOBIL)
            window.addEventListener('keydown', (e) => { if(e.key==='a'||e.key==='ArrowLeft') keys.a=true; if(e.key==='d'||e.key==='ArrowRight') keys.d=true; });
            window.addEventListener('keyup', (e) => { if(e.key==='a'||e.key==='ArrowLeft') keys.a=false; if(e.key==='d'||e.key==='ArrowRight') keys.d=false; });

            // MOBIL DOKUNMATIK DINLEYICILER
            const btnLeft = document.getElementById('btn-left');
            const btnRight = document.getElementById('btn-right');

            const setLeft = (val) => keys.a = val;
            const setRight = (val) => keys.d = val;

            btnLeft.addEventListener('touchstart', (e) => { e.preventDefault(); setLeft(true); });
            btnLeft.addEventListener('touchend', (e) => { e.preventDefault(); setLeft(false); });
            btnLeft.addEventListener('mousedown', () => setLeft(true));
            btnLeft.addEventListener('mouseup', () => setLeft(false));

            btnRight.addEventListener('touchstart', (e) => { e.preventDefault(); setRight(true); });
            btnRight.addEventListener('touchend', (e) => { e.preventDefault(); setRight(false); });
            btnRight.addEventListener('mousedown', () => setRight(true));
            btnRight.addEventListener('mouseup', () => setRight(false));

            if(currentUser) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-menu').style.display = 'flex';
                document.getElementById('welcome-text').innerText = "MERHABA, " + currentUser.toUpperCase();
                document.getElementById('ui-user').innerText = currentUser;
                updateUI();
            }
            animate();
        }

        window.startGame = (m) => {
            speed = { EASY: 0.9, MEDIUM: 1.3, HARD: 1.8 }[m];
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
            spawnLoop();
        };

        function spawnLoop() {
            if(speed === 0) return;
            const obs = new THREE.Mesh(new THREE.BoxGeometry(4.5, 2, 2), new THREE.MeshStandardMaterial({ color: 0x990000 }));
            obs.position.set((Math.random()-0.5)*18, 1, -130);
            scene.add(obs); obstacles.push(obs);

            if(Math.random() < 0.25) {
                const cry = new THREE.Mesh(new THREE.OctahedronGeometry(0.6), new THREE.MeshStandardMaterial({ color: 0xffcc00 }));
                cry.position.set((Math.random()-0.5)*18, 1.2, -130);
                scene.add(cry); crystals.push(cry);
            }
            setTimeout(spawnLoop, 1100 / speed);
        }

        function updateUI() {
            document.getElementById('score-val').innerText = Math.floor(score);
            document.getElementById('bank-val').innerText = users[currentUser].bank;
        }

        function update() {
            if(!speed) return;
            if (keys.a) playerVelX -= 0.09; if (keys.d) playerVelX += 0.09;
            playerVelX *= 0.86; player.position.x += playerVelX;
            player.position.x = Math.max(-9.5, Math.min(9.5, player.position.x));
            player.rotation.y += 0.02;

            decor.forEach(d => { d.position.z += speed; if(d.position.z > 50) d.position.z = -1000; });

            obstacles.forEach((o, i) => {
                o.position.z += speed;
                if(!isImmortal && player.position.distanceTo(o.position) < 1.8) {
                    speed = 0; if(score > users[currentUser].highscore) users[currentUser].highscore = Math.floor(score);
                    save(); alert("BAƒûLANTI KESƒ∞LDƒ∞! SKOR: " + Math.floor(score)); location.reload();
                }
                if(o.position.z > 25) { scene.remove(o); obstacles.splice(i, 1); score += 15; updateUI(); }
            });

            crystals.forEach((c, i) => {
                c.position.z += speed;
                if(player.position.distanceTo(c.position) < 1.8) {
                    const gain = Math.floor(Math.random() * 11) + 5; // 5-15 arasƒ±
                    users[currentUser].bank += gain; scene.remove(c); crystals.splice(i, 1); updateUI();
                }
            });
        }

        function animate() { requestAnimationFrame(animate); update(); renderer.render(scene, camera); }
        init();
    </script>
</body>
</html>
